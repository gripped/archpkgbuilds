From 5d58613479d9639e4abad771b7c3be61cafd4664 Mon Sep 17 00:00:00 2001
From: AntoinePrv <AntoinePrv@users.noreply.github.com>
Date: Mon, 27 Oct 2025 10:25:58 +0100
Subject: [PATCH 1/4] Change xsimd inclusion criterion

---
 cpp/src/arrow/util/byte_stream_split_internal.h | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/cpp/src/arrow/util/byte_stream_split_internal.h b/cpp/src/arrow/util/byte_stream_split_internal.h
index 70f9b87d6c7..fa78a50dc20 100644
--- a/cpp/src/arrow/util/byte_stream_split_internal.h
+++ b/cpp/src/arrow/util/byte_stream_split_internal.h
@@ -29,7 +29,8 @@
 #include <cstdint>
 #include <cstring>
 
-#if defined(ARROW_HAVE_NEON) || defined(ARROW_HAVE_SSE4_2)
+#if defined(ARROW_HAVE_NEON) || defined(ARROW_HAVE_SSE4_2) || \
+    defined(ARROW_HAVE_RUNTIME_AVX2)
 #  include <xsimd/xsimd.hpp>
 #  define ARROW_HAVE_SIMD_SPLIT
 #endif

From 14b038736f28dbcffc4bcea07586382ef42e8a02 Mon Sep 17 00:00:00 2001
From: AntoinePrv <AntoinePrv@users.noreply.github.com>
Date: Mon, 27 Oct 2025 10:27:47 +0100
Subject: [PATCH 2/4] Change xsimd inclusion criterion

---
 cpp/src/arrow/util/byte_stream_split_internal.h | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/cpp/src/arrow/util/byte_stream_split_internal.h b/cpp/src/arrow/util/byte_stream_split_internal.h
index fa78a50dc20..1ba2d5335b3 100644
--- a/cpp/src/arrow/util/byte_stream_split_internal.h
+++ b/cpp/src/arrow/util/byte_stream_split_internal.h
@@ -29,8 +29,9 @@
 #include <cstdint>
 #include <cstring>
 
-#if defined(ARROW_HAVE_NEON) || defined(ARROW_HAVE_SSE4_2) || \
-    defined(ARROW_HAVE_RUNTIME_AVX2)
+// ARROW_HAVE_RUNTIME_SSE4_2 is used on x86-64 to include ARROW_HAVE_SSE4_2 and
+// ARROW_RUNTIME_SIMD_LEVEL != NONE.
+#if defined(ARROW_HAVE_NEON) || defined(ARROW_HAVE_RUNTIME_SSE4_2)
 #  include <xsimd/xsimd.hpp>
 #  define ARROW_HAVE_SIMD_SPLIT
 #endif

From a3f3697ffb63f1975478a35e397885154fc21d01 Mon Sep 17 00:00:00 2001
From: Antoine Prouvost <AntoinePrv@users.noreply.github.com>
Date: Mon, 27 Oct 2025 15:51:24 +0100
Subject: [PATCH 3/4] Update cpp/src/arrow/util/byte_stream_split_internal.h

Co-authored-by: Antoine Pitrou <pitrou@free.fr>
---
 cpp/src/arrow/util/byte_stream_split_internal.h | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/cpp/src/arrow/util/byte_stream_split_internal.h b/cpp/src/arrow/util/byte_stream_split_internal.h
index 1ba2d5335b3..c579d0e0f6c 100644
--- a/cpp/src/arrow/util/byte_stream_split_internal.h
+++ b/cpp/src/arrow/util/byte_stream_split_internal.h
@@ -29,8 +29,7 @@
 #include <cstdint>
 #include <cstring>
 
-// ARROW_HAVE_RUNTIME_SSE4_2 is used on x86-64 to include ARROW_HAVE_SSE4_2 and
-// ARROW_RUNTIME_SIMD_LEVEL != NONE.
+// ARROW_HAVE_RUNTIME_SSE4_2 is used on x86-64 to indicate ARROW_RUNTIME_SIMD_LEVEL != NONE.
 #if defined(ARROW_HAVE_NEON) || defined(ARROW_HAVE_RUNTIME_SSE4_2)
 #  include <xsimd/xsimd.hpp>
 #  define ARROW_HAVE_SIMD_SPLIT

From b34e314d82e15e773acae033c5f928857325e095 Mon Sep 17 00:00:00 2001
From: AntoinePrv <AntoinePrv@users.noreply.github.com>
Date: Mon, 27 Oct 2025 16:30:43 +0100
Subject: [PATCH 4/4] Fix lint

---
 cpp/src/arrow/util/byte_stream_split_internal.h | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/cpp/src/arrow/util/byte_stream_split_internal.h b/cpp/src/arrow/util/byte_stream_split_internal.h
index c579d0e0f6c..33e9f4b28e1 100644
--- a/cpp/src/arrow/util/byte_stream_split_internal.h
+++ b/cpp/src/arrow/util/byte_stream_split_internal.h
@@ -29,7 +29,8 @@
 #include <cstdint>
 #include <cstring>
 
-// ARROW_HAVE_RUNTIME_SSE4_2 is used on x86-64 to indicate ARROW_RUNTIME_SIMD_LEVEL != NONE.
+// ARROW_HAVE_RUNTIME_SSE4_2 is used on x86-64 to indicate
+// ARROW_RUNTIME_SIMD_LEVEL != NONE.
 #if defined(ARROW_HAVE_NEON) || defined(ARROW_HAVE_RUNTIME_SSE4_2)
 #  include <xsimd/xsimd.hpp>
 #  define ARROW_HAVE_SIMD_SPLIT
