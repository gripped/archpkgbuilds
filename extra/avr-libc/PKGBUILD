# Contributor: Corrado Primier <bardo@aur.archlinux.org>
# Contributor: danst0 <danst0@west.de>

# Build order: avr-binutils -> avr-gcc -> avr-libc

pkgname=avr-libc
pkgver=2.3.0
pkgrel=1
pkgdesc='The C runtime library for the AVR family of microcontrollers'
arch=(any)
url='https://github.com/avrdudes/avr-libc'
license=(BSD)
depends=(avr-gcc)
makedepends=(python)
options=(!strip) # it corrupts avr libraries
_tag=avr-libc-${pkgver//./_}-release
source=(https://github.com/avrdudes/avr-libc/archive/refs/tags/$_tag.tar.gz)
b2sums=('d4065e750c08b78afed3c90d0df0a96afe8e94caf416439824827668201e01fcd0c3ce0a8062e08ba44658784c16b5159497138cdffee35efae1cb5c6cd7b7b3')
validpgpkeys=('56628323218C669FF578705C7E9EADC3030D34EB') # Joerg Wunsch

build() {
  cd avr-libc-$_tag
  ./bootstrap
  ./configure --build=$(./config.guess) --host=avr --prefix=/usr
  make
}

package() {
  cd avr-libc-$_tag
  make DESTDIR="$pkgdir" install

  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
