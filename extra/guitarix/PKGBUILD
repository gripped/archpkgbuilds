# Maintainer: David Runge <dvzrv@archlinux.org

pkgname=guitarix
pkgver=0.45.0
pkgrel=1
pkgdesc="A simple mono guitar amplifier and FX for JACK using Faust"
arch=(x86_64)
url="https://guitarix.org"
license=(
  GPL-2.0-or-later
  GPL-3.0-or-later
  LGPL-3.0-or-later
)
groups=(
  lv2-plugins
  pro-audio
)
depends=(
  atkmm
  bluez-libs
  cairo
  cairomm
  gcc-libs
  glibc
  glibmm
  gtkmm3
  libsigc++
  libx11
  pangomm
  ttf-roboto
)
makedepends=(
  avahi
  boost
  curl
  gdk-pixbuf2
  eigen
  faust
  fftw
  glib2
  gperf
  gtk3
  intltool
  jack
  liblo
  liblrdf
  libsndfile
  lilv
  lv2
  pango
  sassc
  waf
  zita-convolver
  zita-resampler
)
optdepends=('new-session-manager: for session management')
provides=(
  guitarix2 libgxw.so libgxwmm.so
  lv2-host
)
conflicts=(guitarix2)
replaces=(guitarix2)
source=(
  $pkgname-$pkgver.tar.xz::https://github.com/brummer10/guitarix/releases/download/V$pkgver/${pkgname}2-$pkgver.tar.xz
)
sha512sums=('be894076f5b016cb8feb243294e8277f893f7e7054c91353f1a82e9b41ef1bc8c97714c4b6cf9765ee6ab1cff91d02f3a0abe525985922dcde788011a88b9cf4')
b2sums=('dfe65b3cdab6cf30c808b65d4d9280617d5b9b9d0227bb6b60b68ac52e64fb34903fdfb3084ebf790630b60a54cfd1f0b170b209b8dfb5c0f23f1d8084e3c342')

build() {
  local waf_options=(
    --prefix=/usr
    --enable-nls
    --shared-lib
    --lib-dev
    --cxxflags='-flto'
    --ldflags="$LDFLAGS"
  )

  export LINKFLAGS="$LDFLAGS"
  waf configure "${waf_options[@]}"
  waf build -vv
}

package() {
  depends+=(
    avahi libavahi-common.so libavahi-gobject.so
    boost-libs libboost_iostreams.so
    curl libcurl.so
    fftw libfftw3f.so
    gdk-pixbuf2 libgdk_pixbuf-2.0.so
    glib2 libgio-2.0.so libglib-2.0.so libgobject-2.0.so
    gtk3 libgdk-3.so
    jack libjack.so
    liblo liblo.so
    liblrdf liblrdf.so
    lilv liblilv-0.so
    pango libpangocairo-1.0.so libpango-1.0.so
    libsndfile libsndfile.so
    zita-convolver libzita-convolver.so
    zita-resampler libzita-resampler.so
  )

  waf install --destdir="$pkgdir"
  # docs
  install -vDm 644 {changelog,README} -t "$pkgdir/usr/share/doc/$pkgname/"
}
