# Maintainer: Christian Hesse <mail@eworm.de>

pkgname=pacredir
pkgver=0.5.0
pkgrel=1
pkgdesc='redirect pacman requests, assisted by avahi service discovery'
arch=('x86_64')
url='https://github.com/eworm-de/pacredir'
license=('GPL-3.0-or-later')
depends=('systemd-libs' 'avahi' 'curl' 'iniparser' 'darkhttpd' 'libmicrohttpd' 'sh')
makedepends=('systemd' 'discount')
conflicts=('pacserve')
install=pacredir.install
backup=('etc/pacman.d/pacredir'
        'etc/pacredir.conf'
        'etc/pacserve.conf')
validpgpkeys=('BD84DE71F493DF6814B0167254EDC91609BC9183') # Christian Hesse <mail@eworm.de>
source=("https://www.eworm.de/download/${pkgname}/${pkgname}-${pkgver}.tar.xz"{,.asc})
sha256sums=('967e98805b715354368da7230736d807129e1ef86347e4a070d9732978c43f67'
            'SKIP')

build() {
  cd ${pkgname}-${pkgver}/

  # https://github.com/curl/curl/pull/17790
  CFLAGS+=' -Wno-attribute-warning'

  make
}

package() {
  cd ${pkgname}-${pkgver}/

  make DESTDIR="${pkgdir}" install
}

