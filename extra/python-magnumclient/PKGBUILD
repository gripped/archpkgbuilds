# Maintainer: Felix Yan <felixonmars@archlinux.org>
# Contributor: Daniel Wallace <danielwallace at gtmanfred dot com>

pkgname=python-magnumclient
pkgver=4.7.0
pkgrel=1
pkgdesc="Client library for Magnum API"
arch=('any')
url="https://docs.openstack.org/python-magnumclient/latest/"
license=('Apache-2.0')
depends=('python' 'python-pbr' 'python-keystoneauth1' 'python-stevedore' 'python-requests'
         'python-oslo-i18n' 'python-oslo-log' 'python-oslo-serialization' 'python-oslo-utils'
         'python-os-client-config' 'python-osc-lib' 'python-prettytable' 'python-cryptography'
         'python-decorator')
makedepends=('git' 'python-build' 'python-installer' 'python-setuptools' 'python-wheel')
checkdepends=('python-openstackclient' 'python-oslotest' 'python-osprofiler' 'python-stestr'
              'python-testscenarios' 'python-testtools')
source=("git+https://github.com/openstack/python-magnumclient.git#tag=$pkgver")
sha512sums=('b2c9c9fb77f453ba4f6a02555b16a75a3cc1ed3b4b2754f397dbaf6c7b4be2aae3a11de7d33c07c19a66f4058785592a557da53e2b5c3cffa00ac674acdf42d5')
b2sums=('b2ce19bfea63dce16721599cd5e461fd9fd611d53b8cccf55626a50757f4b6882673977d913dcde627d287991ead1bd8d3b9646bad426787aa38d1ea12048051')

build() {
  cd python-magnumclient
  python -m build --wheel --no-isolation
}

check() {
  local stestr_run_options=(
    # breaks with Python 3.12
    -E 'magnumclient.tests.test_httpclient.HttpClientTest.test_get_connection'
  )

  cd python-magnumclient
  stestr run "${stestr_run_options[@]}"
}

package() {
  cd python-magnumclient
  python -m installer --destdir="$pkgdir" dist/*.whl
}
