# Maintainer: Anatol Pomozov
# Contributor: Keinv Yue <yuezk001@gmail.com>

pkgname=globalprotect-openconnect
pkgver=2.4.7
pkgrel=1
pkgdesc="A GlobalProtect VPN GUI client based on Openconnect and built with Qt5, supports SAML auth mode"
arch=(x86_64)
url="https://github.com/yuezk/GlobalProtect-openconnect"
license=(GPL3)
depends=(openconnect webkit2gtk-4.1)
makedepends=(git cargo)
provides=(gpclient gpservice)
source=(git+https://github.com/yuezk/GlobalProtect-openconnect#tag=v$pkgver) # github does not allow to download sources with submodules, thus use git directly
sha256sums=('0d75cc7aedbede190d85bc0ef1aa2e0df14e14fd17805fea8b257e5838c8760d')
options=(!lto)

prepare() {
  cd GlobalProtect-openconnect
  cargo fetch --locked --target "$CARCH-unknown-linux-gnu"
}

build() {
  cd GlobalProtect-openconnect
  cargo build --release --frozen
}

package() {
  cd GlobalProtect-openconnect
  DESTDIR="$pkgdir" make install
}
