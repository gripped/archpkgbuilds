# Maintainer: Jakub Klinkovsk√Ω <lahwaacz at archlinux dot org>

# NOTE: python-cuda-pathfinder shares the git repository with python-cuda,
# but it has different versioning scheme and release frequency
pkgname=python-cuda-pathfinder
epoch=1
pkgver=1.4.0
pkgrel=1
pkgdesc="Utilities for locating CUDA components"
arch=(any)
url="https://nvidia.github.io/cuda-python/cuda-pathfinder/latest/index.html"
license=(Apache-2.0)
depends=(
  python
)
makedepends=(
  cuda
  git
  python-wheel
  python-build
  python-installer
  python-setuptools-scm
)
checkdepends=(
  python-pytest
  python-pytest-mock
)
source=(
  python-cuda::git+https://github.com/NVIDIA/cuda-python#tag=cuda-pathfinder-v$pkgver
)
b2sums=('b4bca83f6c0ac0256a0a7cb85f7f06bfd9102555c0dbfc659245f20a501b253e98d03b8c422792ad38598ed12c554db51f186ec5dd11e1d013b0ffcd87ff4edc')

build() {
  cd python-cuda/cuda_pathfinder

  python -m build --wheel --no-isolation
}

check() {
  cd python-cuda/cuda_pathfinder
  python -m venv --system-site-packages test-env
  test-env/bin/python -m installer dist/*.whl
  test-env/bin/python -m pytest tests
}

package() {
  cd python-cuda/cuda_pathfinder
  python -m installer --destdir="$pkgdir" dist/*.whl
  install -vDm 644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}
