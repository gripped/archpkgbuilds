# Maintainer: Robin Candau <antiz@archlinux.org>
# Contributor: Alexander F. RÃ¸dseth <xyproto@archlinux.org>
# Contributor: Allan McRae <allan@archlinux.org>
# Contributor: Alexander Fehr <pizzapunk@gmail.com>

pkgname=pychess
pkgver=1.1.0
pkgrel=1
pkgdesc="Chess client"
url="https://pychess.github.io"
arch=('any')
license=('GPL-3.0-only')
depends=('gst-plugins-base' 'gtksourceview3' 'python-cairo' 'python-gobject'
         'python-ptyprocess' 'python-psutil' 'python-sqlalchemy' 'python-pexpect'
         'python-websockets')
makedepends=('python-build' 'python-installer' 'python-setuptools' 'python-wheel')
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/pychess/pychess/archive/refs/tags/${pkgver}.tar.gz")
sha256sums=('351d6b27b5e4524ae1b752d309e84092f765c6bc254d893de96150c4ea14c056')

prepare() {
	cd "${pkgname}-${pkgver}"
	PYTHONPATH=lib python3 pgn2ecodb.py
	PYTHONPATH=lib python3 create_theme_preview.py
}

build() {
	cd "${pkgname}-${pkgver}"
	python -m build --wheel --no-isolation
}

package() {
	cd "${pkgname}-${pkgver}"
	python -m installer --destdir="${pkgdir}" dist/*.whl

	# FS#59882
	find "${pkgdir}" -wholename 'external/pexpect' -type d -delete
}
