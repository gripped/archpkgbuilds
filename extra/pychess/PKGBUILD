# Maintainer: Robin Candau <antiz@archlinux.org>
# Contributor: Alexander F. RÃ¸dseth <xyproto@archlinux.org>
# Contributor: Allan McRae <allan@archlinux.org>
# Contributor: Alexander Fehr <pizzapunk@gmail.com>

pkgname=pychess
pkgver=1.0.6
pkgrel=1
pkgdesc="Chess client"
url="https://pychess.github.io"
arch=('any')
license=('GPL-3.0-only')
depends=('gst-plugins-base' 'gtksourceview3' 'python-cairo' 'python-gobject'
         'python-ptyprocess' 'python-psutil' 'python-sqlalchemy' 'python-pexpect'
         'python-websockets')
makedepends=('python-build' 'python-installer' 'python-setuptools' 'python-wheel')
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/pychess/pychess/archive/refs/tags/${pkgver}.tar.gz")
sha256sums=('265e40b707635efcb979315a7fd5b0728a5a23c7b2b3bd749ce42003d9afc11e')

prepare() {
	cd "${pkgname}-${pkgver}"
	PYTHONPATH=lib python3 pgn2ecodb.py
	PYTHONPATH=lib python3 create_theme_preview.py
}

build() {
	cd "${pkgname}-${pkgver}"
	python -m build --wheel --no-isolation
}

package() {
	cd "${pkgname}-${pkgver}"
	python -m installer --destdir="${pkgdir}" dist/*.whl

	# FS#59882
	find "${pkgdir}" -wholename 'external/pexpect' -type d -delete
}
