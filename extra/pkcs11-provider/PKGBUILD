# Maintainer: Robin Candau <antiz@archlinux.org>
# Contributor: grawity <grawity@gmail.com>

pkgname=pkcs11-provider
pkgver=1.1.0
pkgrel=1
pkgdesc="A pkcs#11 provider for OpenSSL 3.0+"
url="https://github.com/latchset/pkcs11-provider"
arch=('x86_64')
license=('Apache-2.0')
depends=('glibc' 'openssl>=3.0.7' 'p11-kit')
makedepends=('git' 'meson')
checkdepends=('expect' 'gnutls' 'nss' 'opensc' 'softhsm')
source=("git+${url}.git#tag=v${pkgver}?signed")
sha256sums=('11690dd04e2a9ec447c301e2f5363b4ee3ee6c654fa3bc126fd484a75c8ea3bb')
validpgpkeys=('7C7BD146943B206BB645B64594EAD67E004B65AB')

build() {
	cd "${pkgname}"
	meson setup build --wipe --prefix=/usr --sysconfdir=/etc
	meson compile -C build
}

check() {
	cd "${pkgname}"
	meson test -C build
}

package() {
	cd "${pkgname}"
	meson install -C build --destdir="${pkgdir}"
	install -Dm 644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"
}
