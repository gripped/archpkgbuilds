# Maintainer: Giovanni Harting <anonfunc@archlinux.org>
# Contributor: sgar < swhaat at github >

pkgname=python-aioesphomeapi
_name=${pkgname#python-}
pkgver=43.14.0
pkgrel=1
pkgdesc='Python Client for ESPHome native API'
arch=(x86_64)
url='https://github.com/esphome/aioesphomeapi'
depends=(
  glibc
  python
  python-aiohappyeyeballs
  python-async_interrupt
  python-protobuf
  python-zeroconf
  python-chacha20poly1305-reuseable
  python-cryptography
  python-noiseprotocol
)
makedepends=(python-build python-installer python-wheel python-setuptools git cython)
license=(MIT)
source=(git+$url.git#tag=v$pkgver)
b2sums=('a0d8a3582b0309b7f0a36adeb6240e547de4110c143c8d6a1ccb75ca04d129f79f21fa6ec7fe6f0f7f00f4ed69d28fb6153cd9f6d9fcbb0f864a9151c4772e1a')

prepare() {
  cd $_name
  sed -i 's/==.*//' requirements/base.txt
}

build() {
  cd $_name
  python -m build --wheel --no-isolation
}

package() {
  cd $_name
  python -m installer --destdir="$pkgdir" dist/*.whl
  install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

# vim:set ts=2 sw=2 et:
