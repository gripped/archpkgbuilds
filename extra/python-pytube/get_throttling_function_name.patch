From 226db37951d6c2d8f0e3e79db7b63b6956f34486 Mon Sep 17 00:00:00 2001
From: Davide <davide.gazze@gmail.com>
Date: Wed, 5 Jul 2023 14:19:49 +0200
Subject: [PATCH 01/11] Test throttling

---
 pytube/cipher.py  | 2 +-
 pytube/version.py | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/pytube/cipher.py b/pytube/cipher.py
index d385d83a4..9c5554c64 100644
--- a/pytube/cipher.py
+++ b/pytube/cipher.py
@@ -269,7 +269,7 @@ def get_throttling_function_name(js: str) -> str:
         # a.C && (b = a.get("n")) && (b = Bpa[0](b), a.set("n", b),
         # Bpa.length || iha("")) }};
         # In the above case, `iha` is the relevant function name
-        r'a\.[a-zA-Z]\s*&&\s*\([a-z]\s*=\s*a\.get\("n"\)\)\s*&&\s*'
+        r'a\.[a-zA-Z]\s*&&\s*\([a-z]\s*=\s*a\.get\("n"\)\)\s*&&.*?\|\|\s*([a-z]+)',
         r'\([a-z]\s*=\s*([a-zA-Z0-9$]+)(\[\d+\])?\([a-z]\)',
     ]
     logger.debug('Finding throttling function name')
From 9f8f15f888ae03cb563e23ebd3151b8a8694521f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Davide=20Gazz=C3=A8?= <davide.gazze@gmail.com>
Date: Wed, 22 May 2024 22:37:28 +0200
Subject: [PATCH 02/11] Update cipher.py

---
 pytube/cipher.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pytube/cipher.py b/pytube/cipher.py
index d385d83a4..c01290704 100644
--- a/pytube/cipher.py
+++ b/pytube/cipher.py
@@ -27,7 +27,7 @@
 class Cipher:
     def __init__(self, js: str):
         self.transform_plan: List[str] = get_transform_plan(js)
-        var_regex = re.compile(r"^\w+\W")
+        var_regex = re.compile(r"^[\w\$_]+\W") # fix the regex issue that was causing the error in downloading the video
         var_match = var_regex.search(self.transform_plan[0])
         if not var_match:
             raise RegexMatchError(

From db3c69f04108eb0977d719b9f5a11d449141add0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Davide=20Gazz=C3=A8?= <davide.gazze@gmail.com>
Date: Wed, 22 May 2024 22:44:34 +0200
Subject: [PATCH 06/11] Update cipher.py

---
 pytube/cipher.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pytube/cipher.py b/pytube/cipher.py
index 5925d3301..6c860129c 100644
--- a/pytube/cipher.py
+++ b/pytube/cipher.py
@@ -27,7 +27,7 @@
 class Cipher:
     def __init__(self, js: str):
         self.transform_plan: List[str] = get_transform_plan(js)
-        var_regex = re.compile(r"^[\w\$_]+\W") # fix the regex issue that was causing the error in downloading the video
+        var_regex = re.compile(r"^\$*\w+\W")
         var_match = var_regex.search(self.transform_plan[0])
         if not var_match:
             raise RegexMatchError(

From 146b1aed15f2fd946324b46a7dfb818469165c11 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Davide=20Gazz=C3=A8?= <davide.gazze@gmail.com>
Date: Wed, 22 May 2024 22:44:54 +0200
Subject: [PATCH 07/11] Update version.py

---
 pytube/version.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pytube/cipher.py b/pytube/cipher.py
index 6c860129c..cb4884ac9 100644
--- a/pytube/cipher.py
+++ b/pytube/cipher.py
@@ -27,7 +27,7 @@
 class Cipher:
     def __init__(self, js: str):
         self.transform_plan: List[str] = get_transform_plan(js)
-        var_regex = re.compile(r"^\$*\w+\W")
+        var_regex = re.compile(r"^\$?\w+\W")
         var_match = var_regex.search(self.transform_plan[0])
         if not var_match:
             raise RegexMatchError(

