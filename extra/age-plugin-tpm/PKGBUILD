# Maintainer: Morten Linderud <foxboron@archlinux.org>

pkgname=age-plugin-tpm
pkgver=1.0.1
pkgrel=1
pkgdesc="TPM plugin for age"
arch=("x86_64")
url="https://github.com/Foxboron/age-plugin-tpm"
license=("MIT")
depends=("glibc")
makedepends=("go" "git")
checkdepends=("age")
source=("$pkgname-$pkgver.tar.gz::https://github.com/Foxboron/$pkgname/archive/v${pkgver}.tar.gz")
sha256sums=('d12aababcdc9dad83c5c384161235a9a0b48123ff43db27394ee569f8f5eae5c')

build(){
    cd "${pkgname}-${pkgver}"
    go build \
        -trimpath \
        -buildmode=pie \
        -mod=readonly \
        -modcacherw \
        -ldflags "-X main.version=${pkgver} -linkmode external -extldflags \"${LDFLAGS}\"" \
        -o . ./...
}

check(){
    cd "${pkgname}-${pkgver}"
    go test ./...
}

package(){
    cd "${pkgname}-${pkgver}"
    install -Dm755 -t "${pkgdir}/usr/bin/" age-plugin-tpm
    install -Dm644 -t "${pkgdir}/usr/share/licenses/${pkgname}/" LICENSE
}
