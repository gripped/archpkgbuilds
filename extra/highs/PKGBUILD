# Maintainer: Antonio Rojas <arojas@archlinux.org>

pkgbase=highs
pkgname=(highs
         python-highspy)
pkgver=1.13.1
pkgrel=1
pkgdesc='Linear optimization software'
arch=(x86_64)
url='https://highs.dev/'
license=(MIT)
depends=(gcc-libs
         glibc)
makedepends=(cmake
             git
             pybind11
             python-build
             python-installer
             python-numpy
             python-scikit-build-core)
source=(git+https://github.com/ERGO-Code/HiGHS#tag=v$pkgver)
sha256sums=('3fa37b67d87f491be7a6eeb68cd8135fb523fd71ae50cdc0c60f443b9301ceef')

build() {
  cmake -B build -S HiGHS \
    -DCMAKE_INSTALL_PREFIX=/usr
  cmake --build build

  cd HiGHS
  python -m build --wheel --no-isolation
}

package_highs() {
  depends+=(zlib)

  DESTDIR="$pkgdir" cmake --install build
  install -d "$pkgdir"/usr/share/licenses/$pkgname
}

package_python-highspy() {
  depends+=(python
            python-numpy)

  cd HiGHS
  python -m installer --destdir "$pkgdir" dist/*.whl
  install -Dm644 LICENSE.txt -t "$pkgdir"/usr/share/licenses/$pkgname
}
