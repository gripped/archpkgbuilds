From 91ab25d2b0418c64aa2f001598127e2465a40f64 Mon Sep 17 00:00:00 2001
From: Carl Smedstad <carl.smedstad@protonmail.com>
Date: Sat, 10 Aug 2024 15:31:32 +0200
Subject: [PATCH 05/12] Add missing includes causing compilation error with
 Clang 18.1.8

---
 osquery/core/core.h                                 | 1 +
 osquery/core/shutdown.cpp                           | 1 +
 osquery/core/sql/scheduled_query.h                  | 1 +
 osquery/core/tests/process_tests.cpp                | 1 +
 osquery/core/watcher.cpp                            | 1 +
 osquery/logger/logger.cpp                           | 1 +
 osquery/remote/uri.h                                | 1 +
 osquery/tables/system/posix/openssl_utils.cpp       | 1 +
 osquery/tables/system/tests/system_tables_tests.cpp | 1 +
 osquery/utils/pidfile/tests/pidfile.cpp             | 1 +
 osquery/utils/system/posix/time.cpp                 | 1 +
 osquery/utils/system/time.h                         | 1 +
 osquery/utils/tests/scope_guard.cpp                 | 1 +
 tests/integration/tables/process_open_files.cpp     | 1 +
 14 files changed, 14 insertions(+)

diff --git a/osquery/core/core.h b/osquery/core/core.h
index 4e323a5e6..e05824b27 100644
--- a/osquery/core/core.h
+++ b/osquery/core/core.h
@@ -9,6 +9,7 @@
 
 #pragma once
 
+#include <cstdint>
 #include <string>
 
 #include <osquery/utils/macros/macros.h>
diff --git a/osquery/core/shutdown.cpp b/osquery/core/shutdown.cpp
index 522bde887..9812ebf44 100644
--- a/osquery/core/shutdown.cpp
+++ b/osquery/core/shutdown.cpp
@@ -11,6 +11,7 @@
 #include <osquery/logger/data_logger.h>
 
 #include <atomic>
+#include <condition_variable>
 #include <mutex>
 #include <string>
 
diff --git a/osquery/core/sql/scheduled_query.h b/osquery/core/sql/scheduled_query.h
index ae34ff1f0..b81822f17 100644
--- a/osquery/core/sql/scheduled_query.h
+++ b/osquery/core/sql/scheduled_query.h
@@ -9,6 +9,7 @@
 
 #pragma once
 
+#include <cstdint>
 #include <map>
 #include <string>
 
diff --git a/osquery/core/tests/process_tests.cpp b/osquery/core/tests/process_tests.cpp
index 915760ce2..58b08f7fb 100644
--- a/osquery/core/tests/process_tests.cpp
+++ b/osquery/core/tests/process_tests.cpp
@@ -15,6 +15,7 @@
 #endif
 
 #include <boost/format.hpp>
+#include <fstream>
 
 #include <gtest/gtest.h>
 
diff --git a/osquery/core/watcher.cpp b/osquery/core/watcher.cpp
index 8370e5d69..039c466a5 100644
--- a/osquery/core/watcher.cpp
+++ b/osquery/core/watcher.cpp
@@ -9,6 +9,7 @@
 
 #include <chrono>
 #include <cstring>
+#include <iomanip>
 #include <thread>
 
 #include <math.h>
diff --git a/osquery/logger/logger.cpp b/osquery/logger/logger.cpp
index e3733de70..cddc89be9 100644
--- a/osquery/logger/logger.cpp
+++ b/osquery/logger/logger.cpp
@@ -13,6 +13,7 @@
 
 #include <algorithm>
 #include <future>
+#include <iomanip>
 #include <optional>
 #include <queue>
 #include <thread>
diff --git a/osquery/remote/uri.h b/osquery/remote/uri.h
index 12d531967..bd66d7068 100644
--- a/osquery/remote/uri.h
+++ b/osquery/remote/uri.h
@@ -9,6 +9,7 @@
 
 #pragma once
 
+#include <cstdint>
 #include <string>
 #include <vector>
 
diff --git a/osquery/tables/system/posix/openssl_utils.cpp b/osquery/tables/system/posix/openssl_utils.cpp
index 9d4734c3c..2e56a3ca6 100644
--- a/osquery/tables/system/posix/openssl_utils.cpp
+++ b/osquery/tables/system/posix/openssl_utils.cpp
@@ -12,6 +12,7 @@
 #include <array>
 #include <ctime>
 #include <iomanip>
+#include <memory>
 #include <sstream>
 #include <string>
 
diff --git a/osquery/tables/system/tests/system_tables_tests.cpp b/osquery/tables/system/tests/system_tables_tests.cpp
index 8509cc47c..303f3ac43 100644
--- a/osquery/tables/system/tests/system_tables_tests.cpp
+++ b/osquery/tables/system/tests/system_tables_tests.cpp
@@ -7,6 +7,7 @@
  * SPDX-License-Identifier: (Apache-2.0 OR GPL-2.0-only)
  */
 
+#include <fstream>
 #include <future>
 #include <gflags/gflags.h>
 #include <gtest/gtest.h>
diff --git a/osquery/utils/pidfile/tests/pidfile.cpp b/osquery/utils/pidfile/tests/pidfile.cpp
index 621a5d7d5..2ac3730d1 100644
--- a/osquery/utils/pidfile/tests/pidfile.cpp
+++ b/osquery/utils/pidfile/tests/pidfile.cpp
@@ -8,6 +8,7 @@
  */
 
 #include <cstdlib>
+#include <fstream>
 #include <string>
 
 #include <gtest/gtest.h>
diff --git a/osquery/utils/system/posix/time.cpp b/osquery/utils/system/posix/time.cpp
index dd02f013c..61fb73a83 100644
--- a/osquery/utils/system/posix/time.cpp
+++ b/osquery/utils/system/posix/time.cpp
@@ -9,6 +9,7 @@
 
 #include <osquery/utils/system/time.h>
 
+#include <cstdint>
 #include <string.h>
 
 namespace osquery {
diff --git a/osquery/utils/system/time.h b/osquery/utils/system/time.h
index 05599e543..fe8c94dab 100644
--- a/osquery/utils/system/time.h
+++ b/osquery/utils/system/time.h
@@ -9,6 +9,7 @@
 
 #pragma once
 
+#include <cstdint>
 #include <ctime>
 #include <string>
 
diff --git a/osquery/utils/tests/scope_guard.cpp b/osquery/utils/tests/scope_guard.cpp
index 67ce6bbef..1334c624d 100644
--- a/osquery/utils/tests/scope_guard.cpp
+++ b/osquery/utils/tests/scope_guard.cpp
@@ -8,6 +8,7 @@
  */
 
 #include <chrono>
+#include <fstream>
 #include <string>
 #include <thread>
 
diff --git a/tests/integration/tables/process_open_files.cpp b/tests/integration/tables/process_open_files.cpp
index 7f375f920..6eb613789 100644
--- a/tests/integration/tables/process_open_files.cpp
+++ b/tests/integration/tables/process_open_files.cpp
@@ -16,6 +16,7 @@
 
 #include <boost/filesystem.hpp>
 
+#include <fstream>
 #include <unistd.h>
 
 namespace osquery {
-- 
2.46.0

