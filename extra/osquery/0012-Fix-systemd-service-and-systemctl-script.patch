From ec7ed9caa5598e8f98debfc19bbbe5fd555d3dfb Mon Sep 17 00:00:00 2001
From: Carl Smedstad <carl.smedstad@protonmail.com>
Date: Sat, 17 Aug 2024 16:07:14 +0200
Subject: [PATCH 12/12] Fix systemd service and systemctl script

---
 tools/deployment/linux_packaging/rpm/osqueryd.service |  2 +-
 tools/deployment/osqueryctl                           | 10 +++++-----
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/tools/deployment/linux_packaging/rpm/osqueryd.service b/tools/deployment/linux_packaging/rpm/osqueryd.service
index 6aa42752f..2ca90ffa5 100644
--- a/tools/deployment/linux_packaging/rpm/osqueryd.service
+++ b/tools/deployment/linux_packaging/rpm/osqueryd.service
@@ -7,7 +7,7 @@ TimeoutStartSec=0
 EnvironmentFile=/etc/sysconfig/osqueryd
 ExecStartPre=/bin/sh -c "if [ ! -f $FLAG_FILE ]; then touch $FLAG_FILE; fi"
 ExecStartPre=/bin/sh -c "if [ -f $LOCAL_PIDFILE ]; then mv $LOCAL_PIDFILE $PIDFILE; fi"
-ExecStart=/opt/osquery/bin/osqueryd \
+ExecStart=osqueryd \
   --flagfile $FLAG_FILE \
   --config_path $CONFIG_FILE
 Restart=on-failure
diff --git a/tools/deployment/osqueryctl b/tools/deployment/osqueryctl
index 8afeb3f26..25a2228ee 100755
--- a/tools/deployment/osqueryctl
+++ b/tools/deployment/osqueryctl
@@ -60,7 +60,7 @@ start() {
     cp $PLIST_INSTALLATION_PATH $PLIST_PATH
     launchctl load $PLIST_PATH
   else
-    exec_with_env "service osqueryd start"
+    exec_with_env "systemctl start osqueryd"
   fi
 }
 
@@ -69,7 +69,7 @@ stop() {
     launchctl unload $PLIST_PATH
     rm $PLIST_PATH
   else
-    exec_with_env "service osqueryd stop"
+    exec_with_env "systemctl stop osqueryd"
   fi
 }
 
@@ -86,7 +86,7 @@ status() {
       echo "$PLIST_DOMAIN is running. pid: $LAUNCHCTL_LIST_PID"
     fi
   else
-    exec_with_env "service osqueryd status"
+    exec_with_env "systemctl status osqueryd"
   fi
 }
 
@@ -127,10 +127,10 @@ main() {
     fi
 
     REAL_CONFIG_PATH="/etc/osquery/osquery.conf"
-    EXAMPLE_CONFIG_PATH="/opt/osquery/share/osquery/osquery.example.conf"
+    EXAMPLE_CONFIG_PATH="/usr/share/osquery/osquery.example.conf"
     PIDFILE="/var/run/osquery.pid"
     LOCKFILE="/var/lock/subsys/osqueryd"
-    EXEC="/opt/osquery/bin/osqueryd"
+    EXEC="osqueryd"
   fi
 
   OSQUERY_DB="/var/osquery/osquery.db"
-- 
2.46.0

