# Maintainer: George Rawlinson <grawlinson@archlinux.org>
# Contributor: schuay <jakob.gruber@gmail.com>
# Contributor: Mike Sampson <mike at sambodata dot com>
# Contributor: Adrian Stratulat <adrian.stratulat at inboxcom>
# Contributor: Anton Bazhenov <anton.bazhenov at gmail>
# Contributor: KillaB <xGenoBlast@gmail.com>
# Contributor: Callan Barrett <wizzomafizzo@gmail.com>
# Contributor: Christian Schmidt <xmucknertx@googlemail.com>
# Contributor: Sebastian Sareyko <public@nooms.de>

pkgname=angband
pkgver=4.2.6
pkgrel=1
pkgdesc='A roguelike dungeon exploration game based on the writings of JRR Tolkien'
arch=(x86_64)
url='https://rephial.org/'
license=(GPL-2.0-only CC-BY-3.0 CC-BY-4.0)
depends=(
  glibc
  sdl2
  sdl2_ttf
  sdl2_image
  sdl2_mixer
  ncurses
  xorg-fonts-misc
  xorg-mkfontscale
  hicolor-icon-theme
  libx11
)
makedepends=(git python-docutils)
source=(
  "$pkgname::git+https://github.com/angband/angband#tag=$pkgver"
  remove-dirty-version.patch
)
sha512sums=('e6caae1b4caa66c116e86876353fd2f08b9919afa4e2590676468a8b57f11767ca8e9421480b5c2b6b92b8e59c317d9622331322567a8738e6db3ff1bd379ab2'
            'de2bddb3824d581cf6827b9e86f409f9100245b9ce800611e982fa4a80986b4b9a01aea59a3b60f430ece5425977ce5074843ebf4e3cc91c52b175778f86dbc5')
b2sums=('40574c9367956af9ba89dbfcd0467f618a8da52d6ae1b13c6420d3c1fbde6c3efc68e7ee92d477ae44f2db8277811a37d29c8e2320735b7add2319f0aeb03a7a'
        '84e2a3f0a959072167aaf55718e02643d0b5793da18bc60d5464de0477fe9237e5f6e3374ee0919ca7079fb86a65c011db979e7d9dbe052af8caa883bf16e906')

build() {
  cd "$pkgname"

  # contrary to popular belief, arch linux is *not* dirty.
  patch -p1 -i "$srcdir/remove-dirty-version.patch"

  ./autogen.sh

  ./configure \
    --prefix=/usr \
    --bindir=/usr/bin \
    --sysconfdir=/usr/share/angband \
    --enable-sdl2 \
    --enable-sdl2-mixer

  make
}

package() {
  cd "$pkgname"

  make DESTDIR="$pkgdir" install

  # license
  install -vDm644 docs/copying.rst "$pkgdir/usr/share/licenses/$pkgname/COPYING"
}
