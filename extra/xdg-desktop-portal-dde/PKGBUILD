# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=xdg-desktop-portal-dde
pkgver=1.0.10
pkgrel=1
pkgdesc='A backend implementation for xdg-desktop-portal on Deepin desktop environment'
arch=('x86_64')
url="https://github.com/linuxdeepin/xdg-desktop-portal-dde"
license=('LGPL-3.0-or-later')
depends=('dtk6core' 'dtk6widget' 'qt6-base' 'qt6-wayland' 'wayland' 'glibc' 'gcc-libs'
         'xdg-desktop-portal')
makedepends=('git' 'cmake' 'ninja' 'wlr-protocols' 'qt6-tools' 'treeland-protocols')
provides=(xdg-desktop-portal-impl)
groups=('deepin')
source=("git+https://github.com/linuxdeepin/xdg-desktop-portal-dde.git#tag=$pkgver")
sha512sums=('2fe4788d5f830bd78cafad0cb5925d811828aabfc78eac4b49f8d5aabbf950bbe4f8881a85afc43ea0e9d4a46cdd5e2961addd5e3796fcb6c7e013959fbd8723')

prepare() {
  cd xdg-desktop-portal-dde
  sed -i 's|lrelease|/usr/lib/qt6/bin/lrelease|' misc/translations/translate_generation.sh
}

build() {
  cd xdg-desktop-portal-dde
  cmake . -GNinja -DCMAKE_INSTALL_LIBEXECDIR=lib
  ninja
}

package() {
  cd xdg-desktop-portal-dde
  DESTDIR="$pkgdir" ninja install
}
