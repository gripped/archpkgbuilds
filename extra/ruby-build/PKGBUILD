# Maintainer: Carl Smedstad <carsme@archlinux.org>
# Contributor: Saghm Rossi <saghmrossi@gmail.com>
# Contributor: Peter Hoeg <first name at last name dot com>
# Contributer: Vincent Demeester <vincent@sbr.io>
# Contributer: Alex Ogier <alex.ogier@gmail.com>

pkgname=ruby-build
pkgver=20260121
pkgrel=1
pkgdesc="A tool to download, compile, and install Ruby on Unix-like systems"
arch=('any')
url="https://github.com/rbenv/ruby-build"
license=('MIT')
depends=('bash')
makedepends=('git')
checkdepends=('bats')
optdepends=(
  'git: install ruby from git'
  'libyaml: install recent versions of mri'
  'rust: install ruby with YJIT enabled'
)
source=("git+$url.git#tag=v$pkgver")
b2sums=('5fb834d4819b321ff95b4ce512c9b7b660f350f509c4a0521a4d42db4f714a0ce3cca51ae271682c31a4e55862e74184f0b2603be4c585f631f6a8ca07902226')

prepare() {
  cd $pkgname
  # The unstub openssl function fails for some reason, tests pass without it.
  sed -i '/unstub openssl/d' test/build.bats
}

check() {
  cd $pkgname
  bats test
}

package() {
  cd $pkgname
  install -vDm755 -t "$pkgdir/usr/bin" bin/*
  install -vDm644 -t "$pkgdir/usr/share/$pkgname" share/$pkgname/*
  install -vDm644 -t "$pkgdir/usr/share/man/man1" share/man/man1/*
  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE
}
