diff --git a/libcam/libcam/camview.c b/libcam/libcam/camview.c
index 338ff4d..190d23f 100644
--- a/libcam/libcam/camview.c
+++ b/libcam/libcam/camview.c
@@ -1034,7 +1034,7 @@ void *capture_loop(void *data)
     if(my_options->photo_timer > 0)
     {
         my_photo_timer = NSEC_PER_SEC * my_options->photo_timer;
-        my_last_photo_time = v4l2core_time_get_timestamp(my_vd); /*timer count*/
+        my_last_photo_time = v4l2core_time_get_timestamp(); /*timer count*/
     }
 
     if(my_options->photo_npics > 0)
@@ -1288,9 +1288,9 @@ void *capture_loop(void *data)
  *
  * returns: error code
  */
-int start_encoder_thread(void *data)
+int start_encoder_thread()
 {
-    int ret = __THREAD_CREATE(&encoder_thread, encoder_loop, data);
+    int ret = __THREAD_CREATE(&encoder_thread, encoder_loop, NULL);
 
     if(ret)
         fprintf(stderr, "deepin-camera: encoder thread creation failed (%i)\n", ret);
diff --git a/libcam/libcam_encoder/audio_codecs.c b/libcam/libcam_encoder/audio_codecs.c
index 04e1f61..f4e3419 100644
--- a/libcam/libcam_encoder/audio_codecs.c
+++ b/libcam/libcam_encoder/audio_codecs.c
@@ -40,7 +40,11 @@ extern int verbosity;
 
 /* AAC object types index: MAIN = 1; LOW = 2; SSR = 3; LTP = 4*/
 static int AAC_OBJ_TYPE[5] =
+#if LIBAVCODEC_VER_AT_LEAST(60,26)
+	{ AV_PROFILE_UNKNOWN, AV_PROFILE_AAC_MAIN, AV_PROFILE_AAC_LOW, AV_PROFILE_AAC_SSR, AV_PROFILE_AAC_LTP };
+#else
 	{ FF_PROFILE_UNKNOWN, FF_PROFILE_AAC_MAIN, FF_PROFILE_AAC_LOW, FF_PROFILE_AAC_SSR, FF_PROFILE_AAC_LTP };
+#endif
 /*-1 = reserved; 0 = freq. is writen explictly (increases header by 24 bits)*/
 static int AAC_SAMP_FREQ[16] =
 	{ 96000, 88200, 64000, 48000, 44100, 32000, 24000, 22050, 16000, 12000, 11025, 8000, 7350, -1, -1, 0};
@@ -66,7 +70,11 @@ static audio_codec_t listSupCodecs[] = //list of software supported formats
 		.codec_id     = AV_CODEC_ID_PCM_F32LE,
 		.codec_name   = "pcm_f32le",
 		.sample_format = AV_SAMPLE_FMT_FLT,
+#if LIBAVCODEC_VER_AT_LEAST(60,26)
+		.profile      = AV_PROFILE_UNKNOWN,
+#else
 		.profile      = FF_PROFILE_UNKNOWN,
+#endif
 		.mkv_codpriv  = NULL,
 		.codpriv_size = 0,
 		.flags        = 0,
@@ -83,7 +91,11 @@ static audio_codec_t listSupCodecs[] = //list of software supported formats
 		.codec_id     = AV_CODEC_ID_MP2,
 		.codec_name   = "mp2",
 		.sample_format = AV_SAMPLE_FMT_S16,
+#if LIBAVCODEC_VER_AT_LEAST(60,26)
+		.profile      = AV_PROFILE_UNKNOWN,
+#else
 		.profile      = FF_PROFILE_UNKNOWN,
+#endif
 		.mkv_codpriv  = NULL,
 		.codpriv_size = 0,
 		.flags        = 0,
@@ -104,7 +116,11 @@ static audio_codec_t listSupCodecs[] = //list of software supported formats
 #else
 		.sample_format = AV_SAMPLE_FMT_S16,
 #endif
+#if LIBAVCODEC_VER_AT_LEAST(60,26)
+		.profile      = AV_PROFILE_UNKNOWN,
+#else
 		.profile      = FF_PROFILE_UNKNOWN,
+#endif
 		.mkv_codpriv  = NULL,
 		.codpriv_size = 0,
 		.flags        = 0,
@@ -125,7 +141,11 @@ static audio_codec_t listSupCodecs[] = //list of software supported formats
 #else
 		.sample_format = AV_SAMPLE_FMT_FLT,
 #endif
+#if LIBAVCODEC_VER_AT_LEAST(60,26)
+		.profile      = AV_PROFILE_UNKNOWN,
+#else
 		.profile      = FF_PROFILE_UNKNOWN,
+#endif
 		.mkv_codpriv  = NULL,
 		.codpriv_size = 0,
 		.flags        = 0,
@@ -146,7 +166,11 @@ static audio_codec_t listSupCodecs[] = //list of software supported formats
 #else
 		.sample_format = AV_SAMPLE_FMT_S16,
 #endif
+#if LIBAVCODEC_VER_AT_LEAST(60,26)
+		.profile      = AV_PROFILE_AAC_LOW,
+#else
 		.profile      = FF_PROFILE_AAC_LOW,
+#endif
 		.mkv_codpriv  = AAC_ESDS,
 		.codpriv_size = 2,
 		.flags        = 0,
@@ -167,7 +191,11 @@ static audio_codec_t listSupCodecs[] = //list of software supported formats
 #else
 		.sample_format = AV_SAMPLE_FMT_S16,
 #endif
+#if LIBAVCODEC_VER_AT_LEAST(60,26)
+		.profile      = AV_PROFILE_UNKNOWN,
+#else
 		.profile      = FF_PROFILE_UNKNOWN,
+#endif
 		.mkv_codpriv  =  NULL,
 		.codpriv_size =  0,
 		.flags        = 0,
diff --git a/libcam/libcam_encoder/encoder.c b/libcam/libcam_encoder/encoder.c
index 27194d9..79c0b22 100644
--- a/libcam/libcam_encoder/encoder.c
+++ b/libcam/libcam_encoder/encoder.c
@@ -777,12 +777,19 @@ static encoder_audio_context_t *encoder_audio_init(encoder_context_t *encoder_ct
     audio_codec_data->codec_context->flags |= audio_defaults->flags;
 
     audio_codec_data->codec_context->sample_rate = encoder_ctx->audio_samprate;
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+	if (encoder_ctx->audio_channels < 2)
+		getAvutil()->m_av_channel_layout_copy(&(audio_codec_data->codec_context->ch_layout), &(AVChannelLayout)AV_CHANNEL_LAYOUT_MONO);
+	else
+		getAvutil()->m_av_channel_layout_copy(&(audio_codec_data->codec_context->ch_layout), &(AVChannelLayout)AV_CHANNEL_LAYOUT_STEREO);
+#else
     audio_codec_data->codec_context->channels = encoder_ctx->audio_channels;
 
     if (encoder_ctx->audio_channels < 2)
         audio_codec_data->codec_context->channel_layout = AV_CH_LAYOUT_MONO;
     else
         audio_codec_data->codec_context->channel_layout = AV_CH_LAYOUT_STEREO;
+#endif
 
     audio_codec_data->codec_context->cutoff = 0; /*automatic*/
 
@@ -916,8 +923,12 @@ static encoder_audio_context_t *encoder_audio_init(encoder_context_t *encoder_ct
 
     audio_codec_data->frame->nb_samples = frame_size;
     audio_codec_data->frame->format = audio_defaults->sample_format;
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+    getAvutil()->m_av_channel_layout_copy(&audio_codec_data->frame->ch_layout, &audio_codec_data->codec_context->ch_layout);
+#else
     audio_codec_data->frame->channels = audio_codec_data->codec_context->channels;
     audio_codec_data->frame->channel_layout = audio_codec_data->codec_context->channel_layout;
+#endif
 
     /*set codec data in encoder context*/
     enc_audio_ctx->codec_data = (void *) audio_codec_data;
@@ -1521,10 +1532,17 @@ static int libav_send_encode(AVCodecContext *avctx, AVFrame *frame)
 
         if (avctx->codec_type == AVMEDIA_TYPE_AUDIO && frame->nb_samples != avctx->frame_size)
             fprintf(stderr, "ENCODER: audio samples differ from frame size\n");
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+		if (frame->ch_layout.nb_channels <= 0) {
+			fprintf(stderr, "ENCODER: no audio channels set in frame\n");
+			getAvutil()->m_av_channel_layout_copy(&frame->ch_layout, &avctx->ch_layout);
+		}
+#else
         if (avctx->codec_type == AVMEDIA_TYPE_AUDIO && frame->channels <= 0) {
             fprintf(stderr, "ENCODER: no audio channels set in frame\n");
             frame->channels = avctx->channels;
         }
+#endif
         ret = getLoadLibsInstance()->m_avcodec_send_frame(avctx, frame);
         if (ret < 0) {
             //  fprintf(stderr, "ENCODER: avcodec_send_frame error (%i): %s\n", ret, av_err2str(ret));
@@ -1788,7 +1806,11 @@ int encoder_encode_audio(encoder_context_t *encoder_ctx, void *audio_data)
 
         int buffer_size = getAvutil()->m_av_samples_get_buffer_size(
                               NULL,
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+                              audio_codec_data->codec_context->ch_layout.nb_channels,
+#else
                               audio_codec_data->codec_context->channels,
+#endif
                               audio_codec_data->codec_context->frame_size,
                               audio_codec_data->codec_context->sample_fmt,
                               align);
@@ -1796,7 +1818,11 @@ int encoder_encode_audio(encoder_context_t *encoder_ctx, void *audio_data)
         if (buffer_size <= 0) {
             fprintf(stderr, "ENCODER: (encoder_encode_audio) PCM av_samples_get_buffer_size error (%d): chan(%d) nb_samp(%d) samp_fmt(%d)\n",
                     buffer_size,
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+                    audio_codec_data->codec_context->ch_layout.nb_channels,
+#else
                     audio_codec_data->codec_context->channels,
+#endif
                     audio_codec_data->codec_context->frame_size,
                     audio_codec_data->codec_context->sample_fmt);
 
@@ -1829,7 +1855,11 @@ int encoder_encode_audio(encoder_context_t *encoder_ctx, void *audio_data)
 
         int buffer_size = getAvutil()->m_av_samples_get_buffer_size(
                               NULL,
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+                              audio_codec_data->codec_context->ch_layout.nb_channels,
+#else
                               audio_codec_data->codec_context->channels,
+#endif
                               audio_codec_data->frame->nb_samples,
                               audio_codec_data->codec_context->sample_fmt,
                               align);
@@ -1837,7 +1867,11 @@ int encoder_encode_audio(encoder_context_t *encoder_ctx, void *audio_data)
         if (buffer_size <= 0) {
             fprintf(stderr, "ENCODER: (encoder_encode_audio) av_samples_get_buffer_size error (%d): chan(%d) nb_samp(%d) samp_fmt(%d)\n",
                     buffer_size,
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+                    audio_codec_data->codec_context->ch_layout.nb_channels,
+#else
                     audio_codec_data->codec_context->channels,
+#endif
                     audio_codec_data->frame->nb_samples,
                     audio_codec_data->codec_context->sample_fmt);
 
@@ -1848,7 +1882,11 @@ int encoder_encode_audio(encoder_context_t *encoder_ctx, void *audio_data)
         /*set the data pointers in frame*/
         ret = getLoadLibsInstance()->m_avcodec_fill_audio_frame(
                   audio_codec_data->frame,
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+                  audio_codec_data->codec_context->ch_layout.nb_channels,
+#else
                   audio_codec_data->codec_context->channels,
+#endif
                   audio_codec_data->codec_context->sample_fmt,
                   (const uint8_t *) audio_data,
                   buffer_size,
@@ -1857,7 +1895,11 @@ int encoder_encode_audio(encoder_context_t *encoder_ctx, void *audio_data)
         if (ret < 0) {
             fprintf(stderr, "ENCODER: (encoder_encode_audio) avcodec_fill_audio_frame error (%d): chan(%d) nb_samp(%d) samp_fmt(%d) buff(%d bytes)\n",
                     ret,
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+                    audio_codec_data->codec_context->ch_layout.nb_channels,
+#else
                     audio_codec_data->codec_context->channels,
+#endif
                     audio_codec_data->frame->nb_samples,
                     audio_codec_data->codec_context->sample_fmt,
                     buffer_size);
diff --git a/libcam/libcam_encoder/mp4.c b/libcam/libcam_encoder/mp4.c
index f4ad069..45e98c8 100644
--- a/libcam/libcam_encoder/mp4.c
+++ b/libcam/libcam_encoder/mp4.c
@@ -21,6 +21,7 @@
 
 #include "mp4.h"
 #include <libavutil/mathematics.h>
+#include "camview.h"
 #include "load_libs.h"
 
 static int64_t video_pts = 0;
diff --git a/libcam/libcam_v4l2core/v4l2_core.c b/libcam/libcam_v4l2core/v4l2_core.c
index 2824ddf..c4a74fd 100644
--- a/libcam/libcam_v4l2core/v4l2_core.c
+++ b/libcam/libcam_v4l2core/v4l2_core.c
@@ -2664,7 +2664,7 @@ int v4l2core_probe_h264_config_probe_req(
 /*
  * check for new devices
  * args:
- *   vd - pointer to v4l2 device handler
+ *   none
  *
  * asserts:
  *   my_device_list.udev is not null
@@ -2673,9 +2673,9 @@ int v4l2core_probe_h264_config_probe_req(
  *
  * returns: true(1) if device list was updated, false(0) otherwise
  */
-int v4l2core_check_device_list_events(v4l2_dev_t *vd)
+int v4l2core_check_device_list_events()
 {
-	return check_device_list_events(vd);
+	return check_device_list_events(NULL);
 }
 
 /* get frame format index from format list
diff --git a/src/src/LPF_V4L2.c b/src/src/LPF_V4L2.c
index a91fd41..861e0f3 100644
--- a/src/src/LPF_V4L2.c
+++ b/src/src/LPF_V4L2.c
@@ -107,7 +107,7 @@ int camInit(const char *devicename)
     }
 
     if (my_options->disable_libv4l2)
-        v4l2core_disable_libv4l2(my_vd);
+        v4l2core_disable_libv4l2();
 
     /*选择捕捉方式*/
     if (strcasecmp(my_config->capture, "read") == 0)
diff --git a/src/src/basepub/load_libs.c b/src/src/basepub/load_libs.c
index 34559c9..b2d2650 100644
--- a/src/src/basepub/load_libs.c
+++ b/src/src/basepub/load_libs.c
@@ -363,6 +363,10 @@ static LoadAvutil *newAvutil(void)
     PrintError();
     Avutil->m_av_image_alloc = (uos_av_image_alloc)dlsym(handle5, "av_image_alloc");  
     PrintError();
+#if LIBAVCODEC_VER_AT_LEAST(58, 0)
+    Avutil->m_av_channel_layout_copy = (uos_av_channel_layout_copy)dlsym(handle5, "av_channel_layout_copy");  
+    PrintError();
+#endif
     
     assert(Avutil != NULL);
     return Avutil;
diff --git a/src/src/basepub/load_libs.h b/src/src/basepub/load_libs.h
index e890a84..c9e395e 100644
--- a/src/src/basepub/load_libs.h
+++ b/src/src/basepub/load_libs.h
@@ -88,6 +88,7 @@ typedef int (*uos_av_hwframe_transfer_data)( AVFrame *dst, const AVFrame *src, i
 typedef int (*uos_av_buffer_unref)( AVBufferRef **buf);
 typedef AVBufferRef *(*uos_av_buffer_ref)( AVBufferRef *buf);      //AVBufferRef *av_buffer_ref(AVBufferRef *buf);
 typedef int (*uos_av_image_alloc)( uint8_t *pointers[4], int linesizes[4],int w, int h, enum AVPixelFormat pix_fmt, int align); 
+typedef int (*uos_av_channel_layout_copy) (AVChannelLayout *dst, const AVChannelLayout *src);
 typedef struct SwsContext  *(*uos_sws_getContext)( int srcW, int srcH, enum AVPixelFormat srcFormat,\
                                   int dstW, int dstH, enum AVPixelFormat dstFormat,\
                                   int flags, SwsFilter *srcFilter,\
@@ -265,6 +266,7 @@ typedef struct _LoadAvutil {
     uos_av_buffer_unref  m_av_buffer_unref;
     uos_av_buffer_ref  m_av_buffer_ref;
     uos_av_image_alloc  m_av_image_alloc;
+    uos_av_channel_layout_copy  m_av_channel_layout_copy;
 
 } LoadAvutil;
 LoadAvutil *getAvutil();
