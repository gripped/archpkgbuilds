From 640ac029aeb8475d640f48264aa7a96e82345d96 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ball=C3=B3=20Gy=C3=B6rgy?= <ballogyor@gmail.com>
Date: Mon, 25 Mar 2024 12:54:36 +0100
Subject: [PATCH] Read default terminal from settings

This makes the terminal command configurable.
---
 appIcons.js  | 4 ++--
 extension.js | 3 +++
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/appIcons.js b/appIcons.js
index 00352fd3..4dbf1fc4 100644
--- a/appIcons.js
+++ b/appIcons.js
@@ -45,7 +45,7 @@ import * as Utils from './utils.js';
 import * as PanelSettings from './panelSettings.js';
 import * as Taskbar from './taskbar.js';
 import * as Progress from './progress.js';
-import {DTP_EXTENSION, SETTINGS, DESKTOPSETTINGS, EXTENSION_PATH} from './extension.js';
+import {DTP_EXTENSION, SETTINGS, DESKTOPSETTINGS, TERMINALSETTINGS, EXTENSION_PATH} from './extension.js';
 import {gettext as _, ngettext} from 'resource:///org/gnome/shell/extensions/extension.js';
 
 //timeout names
@@ -1785,7 +1785,7 @@ export const MyShowAppsIconMenu = class extends PopupMenu.PopupMenu {
 
         this._appendItem({
             title: _('Terminal'),
-            cmd: ['gnome-terminal']
+            cmd: [TERMINALSETTINGS.get_string('exec')]
         });
 
         this._appendItem({
diff --git a/extension.js b/extension.js
index 604ebf3c..c40e8068 100644
--- a/extension.js
+++ b/extension.js
@@ -40,6 +40,7 @@ let extensionSystem = Main.extensionManager;
 export let DTP_EXTENSION = null;
 export let SETTINGS = null;
 export let DESKTOPSETTINGS = null;
+export let TERMINALSETTINGS = null;
 export let PERSISTENTSTORAGE = null;
 export let EXTENSION_UUID = null;
 export let EXTENSION_PATH = null;
@@ -76,6 +77,7 @@ export default class DashToPanelExtension extends Extension {
         DTP_EXTENSION = null;
         SETTINGS = null;
         DESKTOPSETTINGS = null;
+        TERMINALSETTINGS = null;
         panelManager = null;
 
         if (!reset) {
@@ -122,6 +124,7 @@ function _enable(extension) {
 
     SETTINGS = extension.getSettings('org.gnome.shell.extensions.dash-to-panel');
     DESKTOPSETTINGS = new Gio.Settings({schema_id: 'org.gnome.desktop.interface'});
+    TERMINALSETTINGS = new Gio.Settings({schema_id: 'org.gnome.desktop.default-applications.terminal'})
     EXTENSION_UUID = extension.uuid
     EXTENSION_PATH = extension.path
 
