From e30dd3da53435970651af4850546e29e77f7e863 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ball=C3=B3=20Gy=C3=B6rgy?= <ballogyor@gmail.com>
Date: Sun, 3 Aug 2025 10:23:19 +0200
Subject: [PATCH] Add D-Bus service file

And mark the application as D-Bus activatable. This allows application
launchers to activate it via D-Bus.
---
 data/dev.bragefuglseth.Fretboard.desktop.in.in |  1 +
 data/dev.bragefuglseth.Fretboard.service.in    |  3 +++
 data/meson.build                               | 10 ++++++++++
 meson.build                                    |  1 +
 4 files changed, 15 insertions(+)
 create mode 100644 data/dev.bragefuglseth.Fretboard.service.in

diff --git a/data/dev.bragefuglseth.Fretboard.desktop.in.in b/data/dev.bragefuglseth.Fretboard.desktop.in.in
index 03e403c..eda259b 100644
--- a/data/dev.bragefuglseth.Fretboard.desktop.in.in
+++ b/data/dev.bragefuglseth.Fretboard.desktop.in.in
@@ -8,5 +8,6 @@ Type=Application
 Categories=Education;GTK;GNOME
 Keywords=guitar;chords
 StartupNotify=true
+DBusActivatable=true
 # Translators: Do NOT translate or transliterate this text (these are enum types)!
 X-Purism-FormFactor=Workstation;Mobile;
diff --git a/data/dev.bragefuglseth.Fretboard.service.in b/data/dev.bragefuglseth.Fretboard.service.in
new file mode 100644
index 0000000..8665fca
--- /dev/null
+++ b/data/dev.bragefuglseth.Fretboard.service.in
@@ -0,0 +1,3 @@
+[D-BUS Service]
+Name=@app-id@
+Exec=@bindir@/fretboard --gapplication-service
diff --git a/data/meson.build b/data/meson.build
index 9fa5253..2301ea4 100644
--- a/data/meson.build
+++ b/data/meson.build
@@ -60,4 +60,14 @@ if compile_schemas.found()
     args: ['--strict', '--dry-run', meson.current_source_dir()])
 endif
 
+service_conf = configuration_data()
+service_conf.set('app-id', app_id)
+service_conf.set('bindir', bindir)
+configure_file(
+  input: '@0@.service.in'.format(base_id),
+  output: '@0@.service'.format(app_id),
+  configuration: service_conf,
+  install_dir: datadir / 'dbus-1' / 'services'
+)
+
 subdir('icons')
diff --git a/meson.build b/meson.build
index a6da134..7786a10 100644
--- a/meson.build
+++ b/meson.build
@@ -18,6 +18,7 @@ dependency('gtk4', version: '>= 4.10.1')
 dependency('libadwaita-1', version: '>= 1.5.alpha')
 
 prefix = get_option('prefix')
+bindir = prefix / get_option('bindir')
 localedir = prefix / get_option('localedir')
 datadir = prefix / get_option('datadir')
 pkgdatadir = datadir / meson.project_name()
