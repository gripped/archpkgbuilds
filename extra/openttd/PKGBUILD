# Maintainer: Laurent Carlier <lordheavym@gmail.com>
# Maintainer: Alexander F. RÃ¸dseth <xyproto@archlinux.org>
# Contributor: Vesa Kaihlavirta <vegai@iki.fi>

pkgname=openttd
pkgver=15.2
pkgrel=1
pkgdesc='Engine for running Transport Tycoon Deluxe'
arch=(x86_64)
url='https://www.openttd.org'
# squirrel (bundled) is licensed under the Zlib license
# fmt (bundled) is licensed under the MIT license
license=('GPL-2.0-only' 'BSD-3-Clause' 'LGPL-2.1-or-later' 'MIT' 'Zlib')
depends=(fluidsynth sdl2-compat fontconfig hicolor-icon-theme)
makedepends=(cmake)
optdepends=('openttd-opengfx: free graphics'
            'openttd-opensfx: free soundset')
source=("https://cdn.$pkgname.org/$pkgname-releases/$pkgver/$pkgname-$pkgver-source.tar.xz")
b2sums=('2d68e6ac013a0cfe4b60896017c27a2a0606a520a52bfe7e7dd1ffec16d0e658dfc7ead2216d8ffd9a0ec94e7f00c4d7d099df60d4dc50ebf32b0bcd83d2a338')

build() {
  cmake \
    -B build \
    -D CMAKE_BUILD_TYPE=Release \
    -D CMAKE_INSTALL_BINDIR=bin \
    -D CMAKE_INSTALL_DATADIR=/usr/share \
    -D CMAKE_INSTALL_PREFIX=/usr \
    -S $pkgname-$pkgver
  make -C build
}

package() {
  DESTDIR="$pkgdir" make -C build install
  cd $pkgname-$pkgver
  install -Dm644 COPYING.md "$pkgdir/usr/share/licenses/$pkgname/COPYING.md"
  for f in CREDITS.md known-bugs.md; do
    install -Dm644 $f "$pkgdir/usr/share/doc/$pkgname/$f"
  done
}
